import requests
from datetime import datetime
import csv

def check_host(ip_address, ssl=False):
    scheme = "https" if ssl else "http"
    url = f"{scheme}://{ip_address}/webui/logoutconfirm.html?logon_hash=1"
    
    try:
        response = requests.post(url, timeout=5)
    except requests.exceptions.Timeout:
        return f"{ip_address}, host clean"
    except Exception as e:
        return f"{ip_address}, Error: {str(e)}"
    
    if '1a80b7389ccd0a5dab' in response.text:
        return f"{ip_address}, Compromised by CVE-2023-20198"
    else:
        return f"{ip_address}, host clean"

def write_to_csv(results):
    with open('scan_results.csv', 'w', newline='') as csvfile:
        fieldnames = ['IP Address', 'Status', 'Timestamp']
        writer = csv.DictWriter(csvfile, fieldnames=fieldnames)
        
        writer.writeheader()
        for result in results:
            ip, status = result.split(', ')
            writer.writerow({'IP Address': ip, 'Status': status, 'Timestamp': datetime.now().strftime('%Y-%m-%d %H:%M:%S')})

if __name__ == "__main__":
    ip_addresses = input("Enter comma-separated IP addresses: ").split(',')
    ip_addresses = [ip.strip() for ip in ip_addresses]  # Remove any extra spaces
    ssl = False  # Change to True for HTTPS
    
    results = []
    for ip_address in ip_addresses:
        result = check_host(ip_address, ssl)
        print(result)
        results.append(result)
        
    write_to_csv(results)
    print("Results saved to scan_results.csv")
